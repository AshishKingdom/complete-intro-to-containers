{
    "componentChunkName": "component---src-templates-lesson-template-js",
    "path": "/buildah",
    "result": {"data":{"markdownRemark":{"html":"<p><strong>NOTE</strong>: Both of these tools <em>only work in Linux</em>. If you're using Windows and WSL, this work seamlessly. If you're on macOS, this will not work. You could try to run this within <a href=\"https://hub.docker.com/r/tomkukral/buildah\">the Buildah container</a> off of Docker Hub. This container has both Buildah and Podman. This is what I'm going to do.</p>\n<h2 id=\"intro\" style=\"position:relative;\"><a href=\"#intro\" aria-label=\"intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Intro</h2>\n<p>While a lot of the gravity of the container world centers on Docker and the Dockery ecosystem, there are other great projects that exist and are worthy of your consideration. I want to take the most brief detour to showcase the totally-open-source alternatives to Docker: <a href=\"https://buildah.io/\">Buildah</a> and <a href=\"https://podman.io/\">Podman</a>. Can we agree that containers projects have the cutest logos ever?</p>\n<p>A lot of the non-Docker support is centered behind what's called the <a href=\"https://www.opencontainers.org/\">Open Container Initiative</a> which is a project underneath the Linux Foundation. Keep in mind that Docker supports the OCI; they're members of it. This is meant to encourage a healthy diversity of players in the field and to have certain common guidelines so that the various sorts of tools can work together. Everybody wins here.</p>\n<p>We're going to talk about these two tools, Buildah and Podman, that allow you to create and run OCI container images. Whereas we've been using Docker to both build and run Docker containers, we're going to use Buildah to build containers and Podman to run them. In reality, with Docker we've been using <code class=\"language-text\">docker</code> to build containers and Docker Desktop has been running <code class=\"language-text\">dockerd</code> in the background to run the containers for us, so the same separation has existed even if we didn't have to know that directly.</p>\n<p>There's a lot to these tools and they overlap quite a bit too. We're just going to introduce you to these and then move on.</p>\n<h2 id=\"buildah\" style=\"position:relative;\"><a href=\"#buildah\" aria-label=\"buildah permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Buildah</h2>\n<h3 id=\"installation\" style=\"position:relative;\"><a href=\"#installation\" aria-label=\"installation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation</h3>\n<p>Follow <a href=\"https://github.com/containers/buildah/blob/master/install.md\">the instructions here</a> for your distro of Linux (if you're not using the container, I will be except for one part at thend):</p>\n<p>This is for only if you're not using the Buildah container. Make sure you have a valid <code class=\"language-text\">/etc/containers/registries.conf</code>. If you don't have that file, put this there:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># This is a system-wide configuration file used to\n# keep track of registries for various container backends.\n# It adheres to TOML format and does not support recursive\n# lists of registries.\n\n# The default location for this configuration file is /etc/containers/registries.conf.\n\n# The only valid categories are: 'registries.search', 'registries.insecure',\n# and 'registries.block'.\n\n[registries.search]\nregistries = ['docker.io', 'registry.fedoraproject.org', 'registry.access.redhat.com']\n\n# If you need to access insecure registries, add the registry's fully-qualified name.\n# An insecure registry is one that does not have a valid SSL certificate or only does HTTP.\n[registries.insecure]\nregistries = []\n\n\n# If you need to block pull access from a registry, uncomment the section below\n# and add the registries fully-qualified name.\n#\n# Docker only\n[registries.block]\nregistries = []</code></pre></div>\n<p>Lastly, make sure you have <code class=\"language-text\">runc</code> installed too. It should be available on every major package manager.</p>\n<p>If you want to do it inside of Docker, run</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> run -it --rm -p <span class=\"token number\">3000</span>:3000 --privileged --mount <span class=\"token assign-left variable\">type</span><span class=\"token operator\">=</span>bind,source<span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">)</span></span>\"</span>,target<span class=\"token operator\">=</span>/src  --mount <span class=\"token assign-left variable\">type</span><span class=\"token operator\">=</span><span class=\"token string\">\"volume\"</span>,src<span class=\"token operator\">=</span>podman-data,target<span class=\"token operator\">=</span>/var/lib/containers tomkukral/buildah <span class=\"token function\">bash</span></code></pre></div>\n<p>This will run the Buildah / Podman container with your current directory mounted in at <code class=\"language-text\">/src</code>. Do note that this in Alpine Linux and you'll be dropped in ash, not bash which does have some differences. Sorta fun though, right? Building containers inside of your containers. Also do note that we're running it as <code class=\"language-text\">--privileged</code> which means the container has elevated privileges. Use this only when you need to.</p>\n<p>We need a volume mount for where the built containers are going to be stored (both ones we build and ones we download from registries) and we need a bind mount for own code being mounted in. We're also exposing port 3000 because when we run the app inside the container (containers within containers) we'll tunnel that port through.</p>\n<h3 id=\"using-buildah\" style=\"position:relative;\"><a href=\"#using-buildah\" aria-label=\"using buildah permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using Buildah</h3>\n<p>Buildah is the tool that allows you to build new containers. It actually allows many different ways of building containers, from writing bash scripts that define the containers to building containers interactively. We're going to do something a bit more familiar to you: Dockerfiles! Yes, Buildah can read and use Dockerfiles. So let's give it a shot.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">buildah bud -f ./Dockerfile -t my-app-buildah <span class=\"token builtin class-name\">.</span> <span class=\"token comment\"># instead of bud, you can use build-using-dockerfile</span></code></pre></div>\n<p>This accomplishes the same thing as <code class=\"language-text\">docker build</code>. It'll take a bit longer and for me it consumed a lot of memory. But once it's done you should see the image when you run <code class=\"language-text\">buildah images</code>. You can inspect it with <code class=\"language-text\">buildah inspect my-app-buildah</code>. Now, you can use Buildah a different way and start using this container interactively but I leave that to your exploration.</p>\n<p>So to see our built container in Buildah (Buildah allows you to do some running of containers but most of that resides in Podman) run <code class=\"language-text\">buildah from my-app-buildah</code>. This will start a container running in the background (and not run the <code class=\"language-text\">CMD</code> in our Dockerfile.) From there, run <code class=\"language-text\">buildah run --net host my-app-buildah-working-container -- bash</code>. This will get us inside the container! You can try to run our project but it'll fail since we haven't connected MongoDB (and we're not going to right now.) Congrats! You built and ran a container without Docker! (again, since we already did it with lxc and lxd.)</p>\n<h2 id=\"podman\" style=\"position:relative;\"><a href=\"#podman\" aria-label=\"podman permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Podman</h2>\n<p>I'm going to do this inside of the <a href=\"https://hub.docker.com/r/tomkukral/buildah\">Buildah container</a> because this was quite difficult to set up outside of it. And in reality most of you will be doing this with Docker anyway so this is more of an academic exercise.</p>\n<p>After having build your container above with Buildah, run this:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">podman</span> run --cgroup-manager cgroupfs -p <span class=\"token number\">3000</span>:3000 localhost/my-app-buildah</code></pre></div>\n<p>This will start Podman managing an instance of your Buildah-built container! This by-default will run your container in the foreground, you can run it in the background with <code class=\"language-text\">-d</code> added.</p>\n<h3 id=\"run-your-buildah-container-with-docker\" style=\"position:relative;\"><a href=\"#run-your-buildah-container-with-docker\" aria-label=\"run your buildah container with docker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Run your Buildah container with Docker</h3>\n<p>In order to do this part, you have to run this outside of a container.</p>\n<p>We need to first transfer our container out of Buildah and into Docker. We also need to be aware that there are two ways to package a container: Docker and OCI. If we tell Buildah to push to Docker, it'll fix that automatically but be aware you can also use OCI (Open Container Initiative) images as well.</p>\n<p>Just like you can push a container to Docker Hub, you can use the same mechanism within Buildah to push to a local Docker daemon (background process.) So ahead and run <code class=\"language-text\">buildah push localhost/my-app-buildah docker-daemon:my-app-buildah:latest</code>. This will move our app out Buildah and into Docker. Now if you run <code class=\"language-text\">docker run -it my-app-buildah bash</code> it should drop you into a running container. As a fun exercise, try to start the Node.js app and connect it to a running <code class=\"language-text\">mongo</code> container using the techniques we learned before. Now you have one container built using Docker connecting to a container built using Buildah. Pretty cool!</p>","frontmatter":{"path":"/buildah","title":"Buildah","order":8,"section":"OCI (Non-Docker) Containers","description":"There are alternatives to Docker. Buildah is a tool that allows you to build new containers. It actually allows many different ways of building containers, from writing bash scripts that define the containers to building containers interactively. Brian shows how to build a OCI container with a Dockerfile via Buildah."}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"order":1,"path":"/intro","title":"Introduction"}}},{"node":{"frontmatter":{"order":2,"path":"/what-are-containers","title":"What Are Containers?"}}},{"node":{"frontmatter":{"order":2.1,"path":"/chroot","title":"chroot"}}},{"node":{"frontmatter":{"order":2.2,"path":"/namespaces","title":"Namespaces"}}},{"node":{"frontmatter":{"order":2.3,"path":"/cgroups","title":"cgroups"}}},{"node":{"frontmatter":{"order":3,"path":"/getting-set-up-with-docker","title":"Getting Set Up with Docker"}}},{"node":{"frontmatter":{"order":3.1,"path":"/docker-images-without-docker","title":"Docker Images without Docker"}}},{"node":{"frontmatter":{"order":3.2,"path":"/docker-images-with-docker","title":"Docker Images with Docker"}}},{"node":{"frontmatter":{"order":3.3,"path":"/nodejs-on-docker","title":"Node.js on Docker"}}},{"node":{"frontmatter":{"order":3.4,"path":"/tags","title":"Tags"}}},{"node":{"frontmatter":{"order":3.5,"path":"/docker-cli","title":"Docker CLI"}}},{"node":{"frontmatter":{"order":4,"path":"/dockerfile","title":"Intro to Dockerfiles"}}},{"node":{"frontmatter":{"order":4.1,"path":"/build-a-nodejs-app","title":"Build a Node.js App"}}},{"node":{"frontmatter":{"order":4.2,"path":"/more-complicated-nodejs-app","title":"A More Complicated Node.js App"}}},{"node":{"frontmatter":{"order":4.4,"path":"/expose","title":"A Note on EXPOSE"}}},{"node":{"frontmatter":{"order":4.5,"path":"/layers","title":"Layers"}}},{"node":{"frontmatter":{"order":5,"path":"/alpine-linux","title":"Alpine Linux"}}},{"node":{"frontmatter":{"order":5.1,"path":"/making-our-own-alpine-nodejs-container","title":"Making Our Own Alpine Node.js Container"}}},{"node":{"frontmatter":{"order":5.2,"path":"/multi-stage-builds","title":"Multi Stage Builds"}}},{"node":{"frontmatter":{"order":5.3,"path":"/static-assets-project","title":"Static Assets Project"}}},{"node":{"frontmatter":{"order":6,"path":"/bind-mounts","title":"Bind Mounts"}}},{"node":{"frontmatter":{"order":6.1,"path":"/volumes","title":"Volumes"}}},{"node":{"frontmatter":{"order":6.2,"path":"/dev-containers","title":"Using Containers for your Dev Environment"}}},{"node":{"frontmatter":{"order":6.3,"path":"/visual-studio-code","title":"Dev Containers with Visual Studio Code"}}},{"node":{"frontmatter":{"order":6.4,"path":"/networking","title":"Networking with Docker"}}},{"node":{"frontmatter":{"order":7,"path":"/docker-compose","title":"Docker Compose"}}},{"node":{"frontmatter":{"order":7.1,"path":"/kubernetes","title":"Kubernetes"}}},{"node":{"frontmatter":{"order":7.2,"path":"/kompose","title":"Kompose"}}},{"node":{"frontmatter":{"order":8,"path":"/buildah","title":"Buildah"}}},{"node":{"frontmatter":{"order":8.1,"path":"/podman","title":"Podman"}}},{"node":{"frontmatter":{"order":9,"path":"/conclusion","title":"Conclusion"}}}]}},"pageContext":{}},
    "staticQueryHashes": ["2959687377"]}